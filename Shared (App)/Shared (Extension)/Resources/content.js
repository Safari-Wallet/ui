(()=>{const e=e=>(t,...n)=>{const s=new XMLHttpRequest;s.onload=e=>{},s.open("POST",`http://localhost:8081/add?message=${t}&sender=${e}.js`,!0),s.send()},t=e=>async(t,n,s={})=>{const o={method:t,params:s};e(`Sending message to SafariWebExtensionHandler: ${JSON.stringify(o)}`);const r=await browser.runtime.sendNativeMessage("ignored",o);if(e(`Result from message: ${JSON.stringify(r)}`),r.error)throw new Error(`Received error from SafariWebExtensionHandler: ${JSON.stringify(r)}`);return r},n=(e,t)=>(n,s,o={})=>{const r={destination:n,method:s,params:o,sessionId:t};return e(`Sending message to browser runtime: ${JSON.stringify(r)}`),browser.runtime.sendMessage(r)},s=(e,t)=>(n,s,o={})=>{const r={destination:n,method:s,params:o,sessionId:t};e(`Sending message to browser tabs: ${JSON.stringify(r)}`),browser.tabs.query({active:!0,currentWindow:!0},(e=>{const[t]=e;t&&t.id&&browser.tabs.sendMessage(t.id,r)}))},o=(e,t)=>(n,s={})=>{const o={method:n,params:s};return e(`Sending message to Ethereum.js: ${JSON.stringify(o)}`),t(o)},r=({logger:e})=>{const r=({method:t,params:n})=>s(e)("content",t,n),i=o(e,(e=>r({method:"forwardToEthereumJs",params:e})));return{sendToContent:r,sendToEthereumJs:i,sendToPopup:(t,s={})=>n(e)("popup",t,s),sendToNative:t(e)}},i=({logger:e})=>{const r=({method:t,params:n})=>s(e)("content",t,n),i=o(e,(e=>r({method:"forwardToEthereumJs",params:e})));return{sendToContent:r,sendToEthereumJs:i,sendToBackground:(t,s={})=>n(e)("background",t,s),sendToNative:t(e)}},a=({logger:e,sessionId:t})=>({sendToPopup:({method:s,params:o})=>n(e,t)("popup",s,o),sendToEthereumJs:({method:e,params:t})=>((e,t,n={})=>window.postMessage({destination:e,method:t,params:n}))("ethereum",e,t),sendToBackground:(s,o={})=>n(e,t)("background",s,o)}),d=e("ethereum"),m={backgroundColor:"#000",height:"100vh",left:"0",opacity:"0",position:"fixed",top:"0",transition:"opacity .2",width:"100vw",willChange:"opacity",zIndex:"9999999"};class c{constructor(){this.opened=!1,this.overlay=document.createElement("div"),Object.assign(this.overlay.style,m),this.overlay.onclick=()=>this.close();const e={alignItems:"center",backgroundColor:"#fff",borderRadius:"8px 8px 0 0",bottom:"0",columnGap:"18px",display:"flex",fontSize:"18px",height:"45px",justifyContent:"center",left:"calc(calc(100vw - 368px) / 2)",position:"fixed",transform:"translateY(100%)",transition:"transform .3s",width:"368px",willChange:"transform",zIndex:"10000000"};this.div=document.createElement("div"),this.div.innerHTML='\n        <svg width="22px" height="16px" viewBox="0 0 22 16" fill="none">\n            <path fill-rule="evenodd" clip-rule="evenodd" d="M0 1.33333C0 0.597005 0.616262 0 1.37634 0H15.1398C15.8998 0 16.5161 0.597005 16.5161 1.33333V6.23633C17.0205 5.68262 17.7583 5.33333 18.5806 5.33333C20.1008 5.33333 21.3333 6.52734 21.3333 8C21.3333 9.47266 20.1008 10.6667 18.5806 10.6667C17.7583 10.6667 17.0205 10.3174 16.5161 9.76367V14.6667C16.5161 15.403 15.8998 16 15.1398 16H1.37634C0.616262 16 0 15.403 0 14.6667V10.2445C0 9.33333 1.61089 9.26921 2.07089 9.77083C2.57526 10.3203 3.31048 10.6667 4.12903 10.6667C5.64919 10.6667 6.88171 9.47266 6.88171 8C6.88171 6.52734 5.64919 5.33333 4.12903 5.33333C3.31048 5.33333 2.57526 5.67969 2.07089 6.22917C1.61089 6.73079 0 6.66667 0 5.75553V1.33333Z" fill="#3478f6" />\n        </svg>\n    ',Object.assign(this.div.style,e),this.message=document.createElement("p"),this.message.innerText="Open the wallet extension to connect",this.div.appendChild(this.message)}close(){window.postMessage("cancel"),this.overlay.style.opacity="0",this.div.style.transform="translateY(100%)",this.overlay.remove(),this.div.remove(),this.opened=!1}isConnected(){}on(e,t){}request(e){return new Promise(((t,n)=>{d("Request",e);const s=e=>{!1===window.ethereum.opened&&(window.ethereum.opened=!0,window.ethereum.message.textContent=e,document.body.insertBefore(window.ethereum.overlay,document.body.firstChild),document.body.insertBefore(window.ethereum.div,document.body.firstChild),setTimeout((()=>{window.ethereum.overlay.style.opacity=.4,window.ethereum.div.style.transform="translateY(0)"}),1))};switch(window.addEventListener("message",(n=>{const{method:s,params:o}=n.data;d("Received message",s,o,{awaiting:e.method}),"eth_requestAccounts"===e.method&&"walletConnected"===s&&(t([o.address]),window.ethereum.close())}),{once:!0}),e.method){case"eth_requestAccounts":s("Open the wallet extension to connect");break;case"eth_signTypedData_v3":s("Open the wallet extension to sign"),t(!0);break;default:d("Invalid or unimplemented method",e.method),t(!1)}}))}}window.ethereum=new c;d("loaded");const h=()=>{let e=window.sessionStorage.getItem("balanceWalletSessionId");return e||(e=Math.random().toString(36).substring(2,15),window.sessionStorage.setItem("balanceWalletSessionId",e)),e},l=e("content"),u=((e,t)=>{if("background"===e)return r(t);if("popup"===e)return i(t);if("content"===e)return a(t);throw new Error(`Unknown origin: ${e}`)})("content",{logger:l,sessionId:h()});var g,p;l("session ID",h()),l("injecting..."),(()=>{const e=document.createElement("script");e.setAttribute("type","text/javascript"),e.setAttribute("async","false"),e.setAttribute("src",browser.runtime.getURL("ethereum/index.js")),document.body.insertBefore(e,document.body.firstChild),d("injected")})(),p=e=>{window.postMessage({...e})},l(`Listening to content.${g="forwardToEthereumJs"}`),browser.runtime.onMessage.addListener(((e,t)=>{const{destination:n,method:s,sessionId:o,params:r}=e;"content"===n&&s===g&&(l(`Received method '${s}' with params: ${JSON.stringify(r)}`),p(r,o))})),window.addEventListener("message",(e=>{l(`Received message from ethereum.js: ${JSON.stringify(e)}`),e.data.method&&u.sendToBackground(e.data.method,e.data.params)})),l("loaded")})();
//# sourceMappingURL=content.js.map
